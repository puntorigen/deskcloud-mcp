# =============================================================================
# Render.com Blueprint Configuration
# =============================================================================
# 
# Deploy this service to Render.com using:
# 1. Connect your GitHub repository
# 2. Render will auto-detect this render.yaml
# 3. Set ANTHROPIC_API_KEY in the environment
#
# Documentation: https://render.com/docs/blueprint-spec

services:
  # ==========================================================================
  # DeskCloud MCP Web Service
  # ==========================================================================
  - type: web
    name: deskcloud-mcp
    env: docker
    
    # Docker configuration
    dockerfilePath: ./docker/Dockerfile
    dockerContext: .
    
    # Health check endpoint
    healthCheckPath: /api/v1/health
    
    # Environment variables
    envVars:
      # Required: Claude API key (set manually in dashboard)
      - key: ANTHROPIC_API_KEY
        sync: false
      
      # Database configuration
      - key: DATABASE_URL
        value: sqlite+aiosqlite:///./data/sessions.db
      
      # Session TTL (1 hour default)
      - key: SESSION_TTL_SECONDS
        value: "3600"
      
      # Cleanup interval (5 minutes)
      - key: CLEANUP_INTERVAL_SECONDS
        value: "300"
      
      # Enable MCP server
      - key: MCP_ENABLED
        value: "true"
      
      # CORS configuration
      - key: CORS_ORIGINS
        value: "*"
      
      # Debug mode (disable in production)
      - key: DEBUG
        value: "false"
      
      # VNC host (use Render service URL)
      - key: VNC_HOST
        fromService:
          name: deskcloud-mcp
          type: web
          property: host
    
    # Persistent disk for SQLite database
    disk:
      name: data
      mountPath: /app/data
      sizeGB: 1
    
    # Auto-deploy on push
    autoDeploy: true
    
    # Branch to deploy
    branch: main

# =============================================================================
# Resource Recommendations
# =============================================================================
#
# | Plan     | RAM   | Max Sessions | Use Case      |
# |----------|-------|--------------|---------------|
# | Starter  | 512MB | 3-4          | Testing       |
# | Standard | 2GB   | 15-20        | Production    |
# | Pro      | 4GB+  | 30-40        | Heavy usage   |
#
# Each session uses ~100MB RAM for Xvfb + browser
# Select plan based on expected concurrent sessions
